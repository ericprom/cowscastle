{"version":3,"sources":["meteor://ðŸ’»app/packages/mrt_paypal/packages/mrt_paypal.js"],"names":[],"mappings":";;;;;;;;;;;;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,0G","file":"/packages/mrt_paypal.js","sourcesContent":["(function () {\n\n/////////////////////////////////////////////////////////////////////////////////////////////////\n//                                                                                             //\n// packages/mrt:paypal/paypal.js                                                               //\n//                                                                                             //\n/////////////////////////////////////////////////////////////////////////////////////////////////\n                                                                                               //\nMeteor.Paypal = {                                                                              // 1\n                                                                                               // 2\n  account_options: {},                                                                         // 3\n  //authorize submits a payment authorization to Paypal                                        // 4\n  authorize: function(card_info, payment_info, callback){                                      // 5\n    Meteor.call('paypal_submit', 'authorize', card_info, payment_info, callback);              // 6\n  },                                                                                           // 7\n  purchase: function(card_info, payment_info, callback){                                       // 8\n    Meteor.call('paypal_submit', 'sale', card_info, payment_info, callback);                   // 9\n  },                                                                                           // 10\n  //config is for the paypal configuration settings.                                           // 11\n  config: function(options){                                                                   // 12\n    this.account_options = options;                                                            // 13\n  },                                                                                           // 14\n  payment_json: function(){                                                                    // 15\n    return {                                                                                   // 16\n      \"intent\": \"sale\",                                                                        // 17\n      \"payer\": {                                                                               // 18\n        \"payment_method\": \"credit_card\",                                                       // 19\n        \"funding_instruments\": []},                                                            // 20\n      \"transactions\": []                                                                       // 21\n    };                                                                                         // 22\n  },                                                                                           // 23\n  //parseCardData splits up the card data and puts it into a paypal friendly format.           // 24\n  parseCardData: function(data){                                                               // 25\n    var first_name = '', last_name = '';                                                       // 26\n    if (data.name){                                                                            // 27\n      first_name = data.name.split(' ')[0];                                                    // 28\n      last_name = data.name.split(' ')[1]                                                      // 29\n    }                                                                                          // 30\n    return {                                                                                   // 31\n      credit_card: {                                                                           // 32\n        type: data.type,                                                                       // 33\n        number: data.number,                                                                   // 34\n        first_name: first_name,                                                                // 35\n        last_name: last_name,                                                                  // 36\n        cvv2: data.cvv2,                                                                       // 37\n        expire_month: data.expire_month,                                                       // 38\n        expire_year: data.expire_year                                                          // 39\n      }};                                                                                      // 40\n  },                                                                                           // 41\n  //parsePaymentData splits up the card data and gets it into a paypal friendly format.        // 42\n  parsePaymentData: function(data){                                                            // 43\n    return {amount: {total: data.total, currency: data.currency}};                             // 44\n  }                                                                                            // 45\n};                                                                                             // 46\n                                                                                               // 47\nif(Meteor.isServer){                                                                           // 48\n  Meteor.startup(function(){                                                                   // 49\n    var paypal_sdk = Npm.require('paypal-rest-sdk');                                           // 50\n    var Fiber = Npm.require('fibers');                                                         // 51\n    var Future = Npm.require('fibers/future');                                                 // 52\n    Meteor.methods({                                                                           // 53\n      paypal_submit: function(transaction_type, cardData, paymentData){                        // 54\n        paypal_sdk.configure(Meteor.Paypal.account_options);                                   // 55\n        var payment_json = Meteor.Paypal.payment_json();                                       // 56\n        payment_json.intent = transaction_type;                                                // 57\n        payment_json.payer.funding_instruments.push(Meteor.Paypal.parseCardData(cardData));    // 58\n        payment_json.transactions.push(Meteor.Paypal.parsePaymentData(paymentData));           // 59\n        var fut = new Future();                                                                // 60\n        this.unblock();                                                                        // 61\n        paypal_sdk.payment.create(payment_json, Meteor.bindEnvironment(function(err, payment){ // 62\n          if (err){                                                                            // 63\n            fut.return({saved: false, error: err});                                            // 64\n          } else {                                                                             // 65\n            fut.return({saved: true, payment: payment});                                       // 66\n          }                                                                                    // 67\n        },                                                                                     // 68\n        function(e){                                                                           // 69\n          console.error(e);                                                                    // 70\n        }));                                                                                   // 71\n        return fut.wait();                                                                     // 72\n    }});                                                                                       // 73\n  });                                                                                          // 74\n}                                                                                              // 75\n                                                                                               // 76\n                                                                                               // 77\n/////////////////////////////////////////////////////////////////////////////////////////////////\n\n}).call(this);\n"]}