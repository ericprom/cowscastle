{"version":3,"sources":["meteor://ðŸ’»app/server/methods.js"],"names":[],"mappings":"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","file":"/server/methods.js","sourcesContent":["/*****************************************************************************/\n/*  Server Methods */\n/*****************************************************************************/\n\nMeteor.methods({\n    'elastic/search': function(search,callback){\n        if (Meteor.isServer){\n            if (typeof search == 'undefined') {\n                search.query = {\n                    \"filtered\": {\n                        \"query\": {\n                            \"match_all\": {}\n                        }\n                    }\n                };\n            }\n            var asyncdata = function(callback) {\n                ES.search({\n                    index: search.index,\n                    type: search.type,\n                    body: {\n                        \"query\": search.query,\n                    }\n                }, function (err, res) {\n                    var results = [];\n                    try {\n                        if (typeof res.hits != 'undefined') {\n                            _.each(res.hits.hits, function(item) {\n                                var doc = {\n                                    // total: res.hits.total,\n                                    _id: item._id,\n                                    // space: item._source.space,\n                                    // venue: item._source.venue,\n                                };\n                                if (typeof item._id != 'undefined') {\n                                    results.push(doc);\n                                }\n                            });\n                        }\n                    }catch(err) {\n                        console.log(err);\n                    }\n                    callback(null, results);\n                });\n            };\n            var syncData = Meteor.wrapAsync(asyncdata);\n            return syncData();\n        }\n    },\n    'send/invitation/email': function(email){\n        // if (Meteor.isServer){\n        //     var result = Meteor.users.find({\"profile.name\": {$regex : \".*\"+search.keyword+\".*\"}}).fetch()\n        //     return result;\n        // }\n        if (Meteor.isServer){\n            SSR.compileTemplate( 'invitaionEmail', Assets.getText( 'invitaion-email.html' ) );\n            Email.send({\n              to:  email.to,\n              from: email.from,\n              subject: email.subject,\n              html: SSR.render( 'invitaionEmail', email.text )\n            });\n        }\n    },\n    'create/castle': function(venue){\n        if (Meteor.isServer){\n            var result = Venues.insert({\n                name:venue.name,\n                createdBy:this.userId,\n                createdAt: new Date\n            });\n            if(result){\n                var team = Teams.insert({\n                    venue_id:result,\n                    createdBy:this.userId,\n                    createdAt: new Date\n                });\n                var staff = Staffs.insert({\n                    team_id:team,\n                    staff_id:this.userId,\n                    role:'owner',\n                    accepted:true,\n                    createdBy:this.userId,\n                    createdAt: new Date\n                });\n            }\n            return result;\n        }\n    },\n    'update/castle/location': function(location){\n        if (Meteor.isServer){\n            var result = Venues.update(location.venue_id,{\n                '$set': {\n                    'location.address': location.address,\n                    'location.latlng': location.latlng,\n                    'location.district': location.district,\n                    'location.city': location.city,\n                    'location.province': location.province,\n                    'location.zipcode': location.zipcode,\n                    'location.phone': location.phone,\n                    'location.email': location.email,\n                    'location.website': location.website,\n                    'updatedBy':this.userId,\n                    'updatedAt': new Date\n                }\n            });\n            return result;\n        }\n    },\n    'update/castle/detail': function(detail){\n        if (Meteor.isServer){\n            var result = Venues.update(detail.venue_id,{\n                '$set': {\n                    'name': detail.name,\n                    'detail.slogan': detail.slogan,\n                    'detail.description': detail.description,\n                    'detail.floors': detail.floors,\n                    'detail.areas': detail.areas,\n                    'detail.rooms': detail.rooms,\n                    'detail.desks': detail.desks,\n                    'updatedBy':this.userId,\n                    'updatedAt': new Date\n                }\n            });\n            return result;\n        }\n    },\n    'update/castle/logo': function(detail){\n        if (Meteor.isServer){\n            var result = Venues.update(detail.venue_id,{\n                '$set': {\n                    'logo': detail.logo,\n                }\n            });\n            return result;\n        }\n    },\n    'update/castle/gallery': function(data){\n        if (Meteor.isServer){\n            var result = Venues.update(data.venue_id,{\n                '$set': {\n                    'gallery': data.gallery,\n                    'updatedBy':this.userId,\n                    'updatedAt': new Date\n                }\n            });\n            return result;\n        }\n    },\n    'update/castle/facility': function(data){\n        if (Meteor.isServer){\n            var result = Venues.update(data.venue_id,{\n                '$set': {\n                    'facility': data.facility,\n                    'updatedBy':this.userId,\n                    'updatedAt': new Date\n                }\n            });\n            return result;\n        }\n    },\n    'delete/castle': function(castle){\n      if (Meteor.isServer){\n        var result = Venues.remove(castle.id);\n        return result;\n      }\n    },\n    'create/throne': function(space){\n        if (Meteor.isServer){\n            var result = Spaces.insert({\n                venue_id:space.venue,\n                name:space.name,\n                createdBy:this.userId,\n                createdAt: new Date\n            });\n            return result;\n        }\n    },\n    'update/throne/detail': function(space){\n        if (Meteor.isServer){\n            var result = Spaces.update(space.space_id,{\n                '$set': {\n                    'instant':space.instant,\n                    'type':space.type,\n                    'name':space.name,\n                    'quantity':space.quantity,\n                    'detail':space.detail,\n                    'per_hour':space.per_hour,\n                    'per_day':space.per_day,\n                    'per_month':space.per_month,\n                    'updatedBy':this.userId,\n                    'updatedAt': new Date\n                }\n            });\n            return result;\n        }\n    },\n    'delete/throne': function(throne){\n      if (Meteor.isServer){\n        var result = Spaces.remove(throne.id);\n        return result;\n      }\n    },\n    'update/throne/poster': function(data){\n        if (Meteor.isServer){\n            var result = Spaces.update(data.space_id,{\n                '$set': {\n                    'poster': data.poster,\n                    'updatedBy':this.userId,\n                    'updatedAt': new Date\n                }\n            });\n            return result;\n        }\n    },\n\n    'create/payment': function(bank){\n        if (Meteor.isServer){\n            var result = Payments.insert({\n                venue_id:bank.venue_id,\n                bank_name:bank.name,\n                account_name:bank.account,\n                account_number:bank.number,\n                createdBy:this.userId,\n                createdAt: new Date\n            });\n            return result;\n        }\n    },\n    'update/payment': function(bank){\n        if (Meteor.isServer){\n            var result = Payments.update(bank.payment_id,{\n                '$set': {\n                    'bank_name':bank.name,\n                    'account_name':bank.account,\n                    'account_number':bank.number,\n                    'updatedBy':this.userId,\n                    'updatedAt': new Date\n                }\n            });\n            return result;\n        }\n    },\n    'delete/payment': function(payment){\n      if (Meteor.isServer){\n        var result = Payments.remove(payment.id);\n        return result;\n      }\n    },\n    'update/user/profile': function(user) {\n        if (Meteor.isServer){\n            var result = Meteor.users.update({\n                '_id': this.userId\n            }, {\n                '$set': {\n                    'profile.name': user.name,\n                    'profile.location': user.location,\n                    'profile.position': user.position,\n                    'profile.company': user.company,\n                    'profile.bio': user.bio,\n                }\n            });\n            return result;\n        }\n    },\n    'booking/space': function(space){\n        if (Meteor.isServer){\n            var result = Bookings.insert({\n                space_id:space.id,\n                date:space.date,\n                duration:space.duration,\n                amount:space.amount,\n                type:space.type,\n                createdBy:this.userId,\n                createdAt: new Date\n            });\n            return result;\n        }\n    },\n});\n"]}